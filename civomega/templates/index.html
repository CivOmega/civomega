{%extends "layout.html" %}


{% block scripts %}
  <script type="text/javascript">
    $(function() {
      $("#question-form").submit(function() {
        $("#error").hide();
        $("#spinner").show();
        $("#results").load(
          "{{url_for('ask')}}",
          $("#question-form").serialize(),
          function(response, status, xhr) {
            if (status == "error") {
              $("#error").show();
              //var msg = "Sorry but there was an error finding your answer: ";
              //$("#error").html(msg + xhr.status + " " + xhr.statusText);
              var msg = "Sorry but there was an error finding your answer. The data source for this question might be having issues; please try again in a few minutes.";
              $("#error").html(msg);
            }
            $("#spinner").hide();
          }
        )
        return false;
      });
      var trigger_search = function() {
        $("#question-form").submit();
      };
      var update_history = function() {
        if (typeof(history.pushState) !== "undefined") {
          history.pushState({}, null, "/?" + $.param({
            'q': $("#question").val()
          }));
        }
      };
      var read_qs = function() {
        var qs = (function(a) {
          if (a == "") return {};
          var b = {};
          for (var i = 0; i < a.length; ++i) {
            var p=a[i].split('=');
            if (p.length != 2) continue;
            b[p[0]] = decodeURIComponent(p[1].replace(/\+/g, " "));
          }
          return b;
        })(window.location.search.substr(1).split('&'));
        if (!!(qs['q']) && (qs['q'] != '')) {
          console.log(qs['q']);
          $("#question").val(qs['q']);
          $("#question-form").submit();
        }
      };


      window.onpopstate = function(event) {
        read_qs();
      };
      $(".example-question").click(function() {
        $("#question").val($(this).text());
        trigger_search();
        update_history();
        return false;
      });

      if (!!($("#question").val()) && typeof(history.replaceState) !== "undefined") {
        history.replaceState({}, null, "/?" + $.param({
          'q': $("#question").val()
        }));
      }
    });
  </script>
{% endblock %}

{% block content %}
  <div class="row">
    <div class="span12" style="margin-bottom:0">
      <form id="question-form" class="form-search" action="{{url_for('ask')}}" method='GET'>
        <img src="/static/img/ajax_wait_16.gif" id="spinner"/>
        <input id="question" type="text" class="span10 input input-xxlarge" name="question" placeholder="What bills are about green energy?">
        <input id="ask" type="submit" class="span2 btn btn-primary" value="Ask!">
      </form>
    </div>
    <div class="span12">
        <p style="margin-top:0">Try these:
            "<a href="#" class="example-question">What legislative bills are about abortion?</a>",
            "<a href="#" class="example-question">What bills did Eric Cantor sponsor?</a>",<br>
            "<a href="#" class="example-question">How many Dominicans live in New York?</a>",
            "<a href="#" class="example-question">Who is talking about climate change?</a>"
        </p>
    </div>
    <div class="span12">
      <div id="error"></div>
      <div id="results"></div>
    </div>
  </div>
{% endblock %}

